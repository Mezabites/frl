CREATE OR REPLACE FUNCTION adm."fnSettingInsertSettingValue"()
RETURNS TRIGGER AS
$$
BEGIN
    INSERT INTO adm."SettingValue" ("Id", "RowCreated", "RowModified", "SettingId", "OrganizationId", "Value")
    SELECT
        gen_random_uuid(),
        CURRENT_TIMESTAMP(3),
        CURRENT_TIMESTAMP(3),
        NEW."Id",
        o."Id",
        NEW."DefaultValue"
    FROM
        adm."Organization" o;

    RETURN NEW;
END;
$$
LANGUAGE plpgsql;

-- Drop the trigger if it exists
DO $$
BEGIN
    IF EXISTS (SELECT 1 FROM pg_trigger WHERE tgname = 'tgSettingInsertSettingValue') THEN
        DROP TRIGGER "tgSettingInsertSettingValue" ON adm."Setting";
    END IF;
END $$;

-- Create the trigger
CREATE TRIGGER "tgSettingInsertSettingValue"
AFTER INSERT ON adm."Setting"
FOR EACH ROW
EXECUTE FUNCTION adm."fnSettingInsertSettingValue"();
